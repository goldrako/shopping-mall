<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="product">

	<!-- 상품 리스트 -->
	<select id="getList" resultType="productvo">
	<![CDATA[
		select no, code, name, price, reg_date regDate, isshow isShow, isoption isOption, shipping_fee shippingFee, order_no orderNo
		from product
		order by no desc
		limit 0, 5
	]]>
	</select>	
	
	<!-- 카테고리 상품 리스트 , 조건 검색어-->
	<select id="getList" resultType="productvo">
	<![CDATA[
		select no, code, name, price, reg_date regDate, isshow isShow, isoption isOption, shipping_fee shippingFee, order_no orderNo
		from product
		where no in (select product_no from category_product where category_no=1)
	]]>
	<if test="keyword != null AND keyword != ''">
	<![CDATA[
		and name like '%1%'
	]]>
	</if>
	<![CDATA[
		order by no desc
		limit 0, 5
	]]>
	</select>	

	
	<!-- 상품 등록 -->
	<insert id="addProduct" parameterType="productvo">
	 	<![CDATA[  
			insert into product
			values(null, "코드번호나중에", 
			#{name }, #{price }, now(), #{isShow }, #{isOption }, #{shippingFee }, 1, #{contents })
		 ]]>
		 
	 	<selectKey keyProperty="no" resultType="long" order="AFTER">
			<![CDATA[
				select last_insert_id()
			]]>
		</selectKey>
	</insert>
	
	<!-- 상품의 카테고리 등록 -->
	<insert id="addCategoryAndProduct" parameterType="map">
	 	<![CDATA[ insert into category_product values ]]>
		<foreach collection="categoryList" item="category" separator=",">
			<![CDATA[ (null, #{category.no } , #{productNo}) ]]>
		</foreach> 
	</insert>
	
	<!-- 옵션 중복 체크 -->
	<select id="getOption" parameterType="string" resultType="optionvo">
	<![CDATA[
		select * 
		from option
		where name=#{name }
	]]>
	</select>
	
	<!-- 상위 옵션 등록 -->
	<insert id="addOption" parameterType="optionvo">
		<![CDATA[
			insert into option
			values(null, #{name })
		]]>
		<selectKey keyProperty="no" resultType="long" order="AFTER">
			<![CDATA[
				select last_insert_id()
			]]>
		</selectKey> 
	</insert>
	
	<!-- 하위 옵션 등록 -->
	<insert id="addOptionValue" parameterType="map">
	 	<![CDATA[ insert into optionvalue values ]]>
		<foreach collection="optionValueList" item="optionValue" separator=",">
			<![CDATA[ (null, #{productNo }, #{optionValue.optionNo }, #{optionValue.value }) ]]>
		</foreach> 
	</insert>


</mapper>
